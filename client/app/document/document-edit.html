<div class="container" ng-init="init()">
  <div class="row">
    <div class="col-xs-12">
      <div class="panel panel-info">
        <div class="panel-heading">문서 편집</div>
        <div class="panel-body">
          <div class="alert alert-info" role="alert" ng-show="hasChangeParentDocument">
            <strong>알림</strong> 상위문서가 변경되었습니다. <span>{{document.parent.title}}</span> (으)로 변경되었습니다.
          </div>
          <form class="form col-xs-12" action="/api/documents" method="POST">
            <input type="text" class="col-xs-12 form-control" ng-model="document.title" placeholder="문서의 제목을 입력하세요."/>
            <div class="col-xs-12 col-md-6 document-edit-wrapper">
              <textarea class="col-xs-12 col-md-6 form-control" name="content" id="content" cols="30" rows="15" ng-model="document.content"
                        placeholder="문서 내용을 입력해주세요. markdown 포맷을 지원합니다."></textarea>
            </div>
            <div class="col-xs-12 col-md-6" id="markdown-view" ng-bind-html="markdownToHTML | toTrusted"></div>
          </form>
        </div>
        <div class="panel-footer">
          <div class="pull-left">
            <a class="btn btn-danger" href="/document/{{document.title}}">취소</a>
          </div>
          <div class="pull-right">
            <button class="btn btn-info" ng-click="parentChangeModal.show()"><i class="fa fa-arrow-circle-up"></i>상위 문서 변경하기</button>
            <button class="btn btn-primary" ng-click="save()"><i class="fa fa-save"></i> 저장</button>
          </div>
          <div class="clearfix"></div>
        </div>
      </div>
    </div>
  </div>
  <script type="text/ng-template" id="parentChangeModal.html">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <h4 class="modal-title">상위문서 바꾸기</h4>
    </div>
    <form class="form form-horizontal">
      <div class="modal-body">
        <div class="form-group">
          <label class="col-xs-4">현재 상위문서</label>
          <div class="col-xs-8">
            <input ng-show="currentDocument.parent.title !== ''" type="text" class="form-control" ng-model="currentDocument.parent.title" readonly/>
            <div ng-show="currentDocument.parent.title === ''">상위문서가 없습니다.</div>
          </div>
        </div>
        <div class="form-group">
          <label class="col-xs-4">변경할 상위문서</label>
          <div class="col-xs-8">
            <input type="text" class="form-control" placeholder="문서명을 2글자 이상 입력하세요." ng-model="searchParentDocumentTitle" ng-keyup="searchParentDocument()"/>
          </div>
        </div>
        <div class="form-group">
          <div class="col-xs-8 col-xs-offset-4">
            <div class="parent-search-result">
              <div ng-show="isNowSearching">
                <i class="fa fa-spin fa-spinner"></i> 검색 중입니다...
              </div>
              <div class="alert alert-danger" role="alert" ng-show="parentAndSubSameError">
                <strong>에러</strong> 현재 문서를 상위문서로 지정할 수 없습니다 이자식아.
              </div>
              <div ng-show="!isNowSearching && searchResults.length === 0">
                검색 결과가 없습니다.
              </div>
              <div ng-show="!isNowSearching && searchResults.length > 0">
                <div>아래 문서 중 하나를 선택하세요.</div>
                <ul class="list-unstyled">
                  <li class="selectable" ng-repeat="parentDocument in searchResults" ng-class="{'selected': parentDocument.selected}"
                      ng-click="select(parentDocument)">
                    {{parentDocument.title}}
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" ng-click="hide()">닫기</button>
        <button type="button" class="btn btn-primary" ng-click="change()" ng-disabled="selectedParentDocument === null">변경</button>
      </div>
    </form>
  </script>
</div>
